# Such a file for "Business Metrics" definitions should be modified only by expert user in a text editor. No API/GUI is needed.
# In "secure mode", a user can only refer to "Business Metrics Definition files" that are registered as "safe" in a reference repo.
# In "free mode", a user can refer to "Business Metrics Definitions files" that are freely modified

############################    Columns of a Business View   #######################################

# metric_id | metric_location | breakdown_property | view_date | scenario_id | metric_value |

####################################################################################################

catalog:
  
  id: antares_area_output

  taxonomy: my_taxonomy

  location:
    taxonomy-group: balance

  metrics-definition: 

  - id: OV.COST
    terms:
      - taxonomy-group: balance
        output-id: imbalance_cost
        location-ports: null 
      - taxonomy-group: production
        output-id: proportional_cost
        location-ports: balance_port
      - taxonomy-group: production
        output-id: non_proportional_cost
        location-ports: balance_port
    terms-operator: sum
    time-operator: sum


  - id: OP.COST
    terms:
      - taxonomy-group: production
        output-id: proportional_cost
        location-ports: balance_port
      - taxonomy-group: production
        output-id: non_proportional_cost
        location-ports: balance_port
    terms-operator: sum
    time-operator: sum

  - id: MRG.PRICE
    terms:
      - taxonomy-group: balance
        output-id: marginal_price
        location-ports: null
    terms-operator: avg
    time-operator: avg

  - id: LOAD
    terms:
      - taxonomy-group: consumption
        output-id: balance_port.flow
        location-ports: balance_port
    terms-operator: sum
    time-operator: sum

  - id: DTG.BY.TECHNOLOGY
    terms:
      - taxonomy-group: production
        output-id: balance_port.flow
        location-ports: balance_port
    terms-operator: sum
    breakdown:
      - key: technology
    time-operator: sum

  - id: BALANCE
    terms:
      - taxonomy-group: exchange
        output-id: out_port.flow
        location-ports: out_port
      - taxonomy-group: exchange
        output-id: in_port.flow
        location-ports: in_port
    terms-operator: sum
    time-operator: sum

  - id: RES.GENERATION
    terms:
      - taxonomy-group: production
        output-id: balance_port.flow
        location-ports: balance_port
    breakdown:
      - key: res_id
    terms-operator: sum
    time-operator: sum

  - id: STS.INJECTION
    terms:
      - taxonomy-group: storage
        output-id: p_injection # Is this feasible?
        location-ports: injection_port
    breakdown:
      - key: sts
    terms-operator: sum
    time-operator: sum

  - id: STS.WITHDRAWAL
    terms:
      - taxonomy-group: storage
        output-id: p_withdrawal
        location-ports: injection_port
    breakdown:
      - key: sts
    terms-operator: sum
    time-operator: sum

  - id: STS.LEVEL
    terms:
      - taxonomy-group: storage
        output-id: level
        location-ports: injection_port
    breakdown:
      - key: sts
    terms-operator: avg
    time-operator: avg

  - id: UNSP.ENRG
    terms:
      - taxonomy-group: balance
        output-id: unsupplied_energy
        location-ports: null
    terms-operator: sum
    time-operator: sum

  - id: SPIL.ENRG
    terms:
      - taxonomy-group: balance
        output-id: spillage
        location-ports: null
    terms-operator: sum
    time-operator: sum

  - id: NODU # Not quite sure this is right approach ?
    terms:
      - taxonomy-group: production
        output-id: nb_units_on
        location-ports: balance_port
    filter:
      - key: distpachable
        value: nodu
    terms-operator: sum
    time-operator: sum

  - id: NP.COST # Not quite sure this is right approach ?
    terms:
      - taxonomy-group: production
        output-id: non_proportional_cost
        location-ports: balance_port
    filter:
      - key: cost
        value: np_cost
    terms-operator: sum
    time-operator: sum

  - id: AVL.DTG # Can i directly use parameters?
    terms:
      - taxonomy-group: production
        output-id: p_max_cluster
        location-ports: balance_port
    filter:
      - key: distpachable
        value: max_availability
    terms-operator: sum
    time-operator: sum

  - id: DTG.MRG
    terms:
      - taxonomy-group: production
        output-id: distpachable_margin
        location-ports: balance_port
    filter:
      - key: distpachable
        value: margin
    terms-operator: sum
    time-operator: sum

  - id: LOLD
    terms:
      - taxonomy-group: balance
        output-id: unsupplied_energy_duration
        location-ports: null
    terms-operator: sum
    time-operator: sum

  - id: LOLP
    terms:
      - taxonomy-group: balance
        output-id: unsupplied_energy_probability
        location-ports: null
    terms-operator: sum
    time-operator: sum

  - id: DTG.BY.PLANT
    terms:
      - taxonomy-group: production
        output-id: balance_port.flow
        location-ports: balance_port
    terms-operator: sum
    breakdown:
      - key: plant_name
    time-operator: sum