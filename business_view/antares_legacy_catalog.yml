# Such a file for "Business Metrics" definitions should be modified only by expert user in a text editor. No API/GUI is needed.
# In "secure mode", a user can only refer to "Business Metrics Definition files" that are registered as "safe" in a reference repo.
# In "free mode", a user can refer to "Business Metrics Definitions files" that are freely modified

############################    Columns of a Business View   #######################################

# metric_id | metric_location | breakdown_property | view_date | scenario_id | metric_value |

####################################################################################################

catalog:
  
  id: antares_area_output

  taxonomy: my_taxonomy

  location:
    taxonomy-group: area # str | tuple(str)
    #The category of models in the taxonomy that will serve as "location-ports" for these metrics
    #balance is the taxonomy group for area, zones... etc

  metrics-definition: 

  - id: OV.COST
    terms:
      - taxonomy-group: area
        output-id: ens_and_spillage_cost
        location-ports: null 
      - taxonomy-group: production
        output-id: proportional_cost
        location-ports: balance_port
      - taxonomy-group: production #indicates that the "location" column will be filled with the id of the balance objects to which the consumption object is connected through "balance_port"
        output-id: non_proportional_cost
        location-ports: balance_port #indicates that the "location" column will be filled with the id of the balance objects to which the consumption object is connected through "balance_port"

    terms-operator: sum # Possible values : sum | avg | weighted_sum | weighted_avg # Defines how we aggregate the contributions of the differents terms, over all components 
    #breakdown: None
    #filter: None
    time-operator: sum  # sum | avg | weighted_sum | weighted_avg # Defines how we aggregate over the temporal dimension.    

  - id: UNSP_ENRG
    terms:
      - taxonomy-group: balance
        output-id: energy_not_served 
        location-ports: null
    terms-operator: sum # sum | avg | weighted_sum | weighted_avg
    #breakdown: None
    #filter: None
    time-operator: sum # sum | avg 

  - id: GENERATION_COST
    terms:
      - taxonomy-group: production
        output-id: operational_cost
        location-ports: balance_port
    terms-operator: sum
    time-operator: sum

  - id: BALANCE
    terms:
      - taxonomy-group: area
        output-id: unsupplied_energy - spillage
        location-ports: null
      - taxonomy-group: production
        output-id: generation
        location-ports: null
    terms-operator: sum
    time-operator: sum

  - id: PRICE
    terms:
      - taxonomy-group:  balance
        output-id: price
        location-ports: null
    terms-operator: avg
    time-operator: avg # In a variant, one could also apply a weighted_avg.

  - id: LOAD
    terms:
      - taxonomy-group : consumption
        output-id: balance_port.flow
        location-ports: balance_port
    terms-operator: sum
    time-operator: sum

  - id: GENERATION_BY_TECHNO
    terms:
      - taxonomy-group: production
        output-id: balance_port.flow
        location-ports: balance_port
    terms-operator: sum
    #filter: None
    breakdown: #breakdown with respect to a key available on components.
      - key: technology
    time-operator: sum

  - id: SOLAR
    terms:
      - taxonomy-group: production
        output-id: balance_port.flow
        location-ports: balance_port
    terms-operator: sum
    filter:
      - key: technology #filtering with respect to a key available on components, for a given value.
        value: solar
    time-operator: sum

  - id: WIND
    terms:
      - taxonomy-group: production
        output-id: balance_port.flow
        location-ports: balance_port
    terms-operator: sum
    filter:
      - key: technology
        value: wind
    time-operator: sum

  - id: GENERATION_BY_PLANT
    terms:
      - taxonomy-group: production
        output-id: balance_port.flow
        location-ports: balance_port
    terms-operator: sum
    #filter: None
    breakdown:
      - key: plant_name
    time-operator: sum

  - id: VECTOR_ENERGY_BALANCE
    terms:
      - taxonomy-group: link # (intra system links)
        output-id: balance_port_0.flow
        location-ports: balance_port_0 #(-> area : fr_elec)
      - taxonomy-group: link
        output-id: balance_port_1.flow
        location-ports: balance_port_1
    terms-operator: sum
    time-operator: sum

  - id: TOTAL_ENERGY_BALANCE
    terms:
      - taxonomy-group: link
        output-id: balance_port_0.flow
        location-ports: balance_port_0
      - taxonomy-group: link
        output-id: balance_port_1.flow
        location-ports: balance_port_1
      - taxonomy-group: converter # (extra system links)
        output-id: balance_port_0.flow
        location-ports: balance_port_0
      - taxonomy-group: converter
        output-id: balance_port_1.flow
        location-ports: balance_port_1
    terms-operator: sum
    time-operator: sum

  - id: CAPACITY_BY_TECHNO
    terms:
      - taxonomy-group: production
        output-id: p_max #To do : extra-output to add in the model (library file)
        location-ports: balance_port
    terms-operator: sum
    #filter: None
    breakdown:
      - key: technology
    time-operator: avg

  - id: FACTOR_BY_TECHNO
    terms:
      - taxonomy-group: production
        output-id: load_factor #To do : extra-output to add in the model (library file)
        weight-output-id: p_max #Mandatory if term-operator = weighted_avg or weighted_sum
        ## WARNING: one has to handle the fact that P_MAX may not be time- or scenario-dependant, where as load_factor is.
        location-ports: balance_port
    terms-operator: weighted_avg
    #filter: None
    breakdown:
      - key: technology
    time-operator: weighted_avg
