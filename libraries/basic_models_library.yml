library:
  id: basic_models_library
  description: Ready for use basic models to build simple optimal dispatch problems


  port-types:
    - id: flow
      description: A port which transfers power flow
      fields:
        - id: flow
    - id: energy
      description: Port for limiting generation for all generators for current model of generator in this library
      fields:
        - id: cumulative_energy
    - id: co2_emission_constraint
      description: Port for limiting generation for all or selected set of generators based on CO2 emission factors
      fields:
        - id: co2_e

  models:
    - id: bus
      parameters:
        - id: spillage_cost
        - id: unsupllied_energy_cost
      variables:
        - id: spillage
          lower-bound: 0
          variable-type: continuous
        - id: unsupplied_energy
          lower-bound: 0
          variable-type: continuous
      ports:
        - id: balance_port
          type: flow
      binding-constraints:
        - id: balance
          expression: sum_connections(balance_port.flow) = spillage - unsupplied_energy
      objective-contributions:
        - id: objective
          expression: sum(spillage_cost * spillage + unsupllied_energy_cost * unsupplied_energy)
    - id: load
      parameters:
        - id: load
          time-dependent: true
          scenario-dependent: true
      ports:
        - id: balance_port
          type: flow
      port-field-definitions:
        - port: balance_port
          field: flow
          definition: -load

    - id: link
      parameters:
        - id: capacity_direct
          time-dependent: true
          scenario-dependent: true
        - id: capacity_indirect
          time-dependent: true
          scenario-dependent: true
      variables:
        - id: flow_direct
          lower-bound: 0
          upper-bound: capacity_direct
          variable-type: continuous
        - id: flow_indirect
          lower-bound: 0
          upper-bound: capacity_indirect
          variable-type: continuous
        - id: flow
          lower-bound: -capacity_indirect
          upper-bound: capacity_direct
          variable-type: continuous
      ports:
        - id: out_port
          type: flow
        - id: in_port
          type: flow
      port-field-definitions:
        - port: out_port
          field: flow
          definition: flow
        - port: in_port
          field: flow
          definition: -flow
      constraints:
        - id: flow_direct_indirect
          expression: flow = flow_direct - flow_indirect

    - id: renewable
      parameters:
        - id: generation
          time-dependent: true
          scenario-dependent: true
      ports:
        - id: balance_port
          type: flow
      port-field-definitions:
        - port: balance_port
          field: flow
          definition: generation

    - id: generator
      parameters:
        - id: p_min
          scenario-dependent: true
          time-dependent: true
        - id: p_max
          scenario-dependent: true
          time-dependent: true
        - id: generation_cost
        - id: co2_emission_factor  # t/MW
      variables:
        - id: generation
          lower-bound: p_min
          upper-bound: p_max
          variable-type: continuous
      ports:
        - id: balance_port
          type: flow
        - id: energy_port
          type: energy
        - id: co2_emmision
          type: co2_emission_constraint
      port-field-definitions:
        - port: balance_port
          field: flow
          definition: generation
        - port: energy_port
          field: cumulative_energy
          definition: generation
        - port: co2_emmision
          field: co2_e
          definition: generation * co2_emission_factor
      objective-contributions:
        - id: objective
          expression: sum(generation_cost * generation)

    - id: short-term-storage
      parameters:
        - id: reservoir_capacity
          time-dependent: false
          scenario-dependent: false
        - id: injection_nominal_capacity
          time-dependent: false
          scenario-dependent: false
        - id: withdrawal_nominal_capacity
          time-dependent: false
          scenario-dependent: false
        - id: efficiency_injection
          time-dependent: false
          scenario-dependent: false
        - id: efficiency_withdrawal
          time-dependent: false
          scenario-dependent: false
        - id: initial_level
          time-dependent: false
          scenario-dependent: true
      variables:
        - id: p_injection
          lower-bound: 0
          upper-bound: injection_nominal_capacity
          variable-type: continuous
        - id: p_withdrawal
          lower-bound: 0
          upper-bound: withdrawal_nominal_capacity
          variable-type: continuous
        - id: level
          lower-bound: 0
          upper-bound: reservoir_capacity
          variable-type: continuous
      ports:
        - id: injection_port
          type: flow
      port-field-definitions:
        - port: injection_port
          field: flow
          definition: p_withdrawal - p_injection
      constraints:
        - id: initial_level_constraint
          expression: level[0] = initial_level * reservoir_capacity
        - id: Level equation
          expression: level[t+1] = level + efficiency_injection * p_injection - efficiency_withdrawal * p_withdrawal


    - id: co2_emission_constraint
      description: Model for hard energy limitation constraint that enforces must run generation
      parameters:
        - id: rhs  # Tons of CO2
          time-dependant: true
          scenario-dependent: true
      ports:
        - id: co2_emmision
          type: co2_emission_constraint
      binding-constraints:
        - id: co2_constraint
          expression: sum_connections(co2_emmision.co2_e) <= rhs


    - id: energy_limitation_hard_constraint_set
      description: Model for hard energy limitation constraint that enforces must run generation
      parameters:
        - id: rhs
          time-dependant: true
          scenario-dependent: true
      ports:
        - id: energy_port
          type: energy
      binding-constraints:
        - id: set_generation_constraint
          expression: sum_connections(energy_port.cumulative_energy) = rhs

    - id: energy_limitation_hard_constraint_max
      description: Model for hard energy limitation constraint that enforces maximum generation constraint
      parameters:
        - id: rhs
          time-dependant: true
          scenario-dependent: true
      ports:
        - id: energy_port
          type: energy
      binding-constraints:
        - id: max_generation_hard
          expression: sum_connections(energy_port.cumulative_energy) <= rhs

    - id: energy_limitation_hard_constraint_min
      description: Model for hard energy limitation constraint that enforces minimum generation constraint
      parameters:
        - id: rhs
          time-dependant: true
          scenario-dependent: true
      ports:
        - id: energy_port
          type: energy
      binding-constraints:
        - id: min_generation_hard
          expression: sum_connections(energy_port.cumulative_energy) >= rhs

    - id: energy_limitation_soft_constraint_max
      description: Model for soft energy limitation constraint that enforces maximum generation constraint
      parameters:
        - id: constraint_cost
          time-dependant: false
          scenario-dependent: false
        - id: rhs
          time-dependant: true
          scenario-dependent: true
      variables:
        - id: slack
          lower-bound: 0
          variable-type: continuous
      ports:
        - id: energy_port
          type: energy
      binding-constraints:
        - id: max_generation_soft
          expression: sum_connections(energy_port.cumulative_energy) <= rhs + slack
      objective-contributions:
        - id: objective
          expression: sum(slack * constraint_cost)

    - id: energy_limitation_soft_constraint_min
      description: Model for soft energy limitation constraint that enforces minimum generation constraint
      parameters:
        - id: constraint_cost
          time-dependant: false
          scenario-dependent: false
        - id: rhs
          time-dependant: true
          scenario-dependent: true
      variables:
        - id: slack
          lower-bound: 0
          variable-type: continuous
      ports:
        - id: energy_port
          type: energy
      binding-constraints:
        - id: min_generation_soft
          expression: sum_connections(energy_port.cumulative_energy) >= rhs + slack
      objective-contributions:
        - id: objective
          expression: sum(slack * constraint_cost)
