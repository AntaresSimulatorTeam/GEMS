# Unit Commitment Models Library
# This library defines models for a simple unit commitment problem
# with generator, renewable sources, and load.

library:
  id: unit_commitment_library
  description: Models for unit commitment optimization

  port-types:
    - id: flow_port
      description: A port that transfers a power flow.
      fields:
        - id: flow

  models:

    # Bus model: central node for power balance
    - id: bus
      parameters:
        - id: spillage_cost
        - id: unsupplied_energy_cost
      variables:
        - id: spillage
          lower-bound: 0
          variable-type: continuous
        - id: unsupplied_energy
          lower-bound: 0
          variable-type: continuous
      ports:
        - id: balance_port
          type: flow_port
      binding-constraints:
        - id: balance
          expression: sum_connections(balance_port.flow) = spillage - unsupplied_energy
      objective-contributions:
        - id: objective
          expression: sum(spillage * spillage_cost + unsupplied_energy * unsupplied_energy_cost)


    # Load model: consumes power (negative flow)
    - id: load
      parameters:
        - id: load
          time-dependent: true
          scenario-dependent: true
      ports:
        - id: balance_port
          type: flow_port
      port-field-definitions:
        - port: balance_port
          field: flow
          definition: -load


    # Thermal model: dispatchable thermal units
    - id: thermal
      parameters:
        - id: p_min_cluster
          scenario-dependent: true
          time-dependent: true
        - id: p_max_cluster # timeseries that takes outages into account
          scenario-dependent: true
          time-dependent: true
        - id: p_min_unit
        - id: p_max_unit
        - id: generation_cost
        - id: startup_cost
        - id: fixed_cost
        - id: d_min_up
        - id: d_min_down
        - id: nb_units_min # Equals to ceil(p_min_cluster/p_max_unit), to be done in preprocessing
          scenario-dependent: true
          time-dependent: true
        - id: nb_units_max # Equals to ceil(p_max_cluster/p_max_unit), to be done in preprocessing
          scenario-dependent: true
          time-dependent: true
        - id: nb_units_max_variation_forward
          scenario-dependent: true
          time-dependent: true
        - id: nb_units_max_variation_backward
          scenario-dependent: true
          time-dependent: true
      variables:
        - id: generation
          lower-bound: p_min_cluster
          upper-bound: p_max_cluster
          variable-type: continuous
        - id: nb_units_on
          lower-bound: nb_units_min
          upper-bound: nb_units_max
          variable-type: integer
        - id: nb_starting
          lower-bound: 0
          upper-bound: nb_units_max
          variable-type: integer
        - id: nb_stopping
          lower-bound: 0
          upper-bound: nb_units_max
          variable-type: integer
        - id: nb_failing
          lower-bound: 0
          upper-bound: nb_units_max
          variable-type: integer
      ports:
        - id: balance_port
          type: flow
      port-field-definitions:
        - port: balance_port
          field: flow
          definition: generation
      constraints:
        - id: max_generation
          expression: generation <= nb_units_on * p_max_unit
        - id: min_generation
          expression: generation >= nb_units_on * p_min_unit
        - id: on_units_dynamics
          expression: nb_units_on = nb_units_on[t-1] + nb_starting - nb_stopping
        - id: nb_failing_lower_than_stopping
          expression: nb_failing <= nb_stopping
        - id: nb_failing_lower_than_max_variation
          expression: nb_failing <= nb_units_max_variation_forward
        - id: min_up_duration
          expression: sum(t-d_min_up + 1 .. t, nb_starting - nb_failing) <= nb_units_on
        - id: min_down_duration
          expression: sum(t-d_min_down + 1 .. t, nb_stopping) <= nb_units_max[t-d_min_down] - nb_units_on + sum(t-d_min_down + 1 .. t, nb_units_max_variation_backward)
      objective-contributions:
        - id: objective
          expression: sum(generation_cost * generation + startup_cost * nb_starting + fixed_cost * nb_units_on)



    # Renewable model: non-dispatchable generation (solar, wind)
    - id: renewable
      parameters:
        - id: generation
          time-dependent: true
          scenario-dependent: true
      ports:
        - id: balance_port
          type: flow_port
      port-field-definitions:
        - port: balance_port
          field: flow
          definition: generation
